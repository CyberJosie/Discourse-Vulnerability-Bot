import json
import requests

# cve.circl.lu

class CVEScout:
    
    def __init__(self):
        self.vendors = {}

    # easy post
    def _post(self, url, headers={}):
        try:
            response = requests.post(url, headers=headers)
            return response.content
        except Exception as e:
            print(e)
            return ''
    
    # easy get
    def _get(self, url, headers={}):
        try:
            response = requests.get(url)
            res =  response.json()
            self.vendors = res
            return res
        except Exception as e:
            print(e)
            return -1


    # gets a list of vendors from main DB
    def get_vendors(self):
        url = 'https://cve.circl.lu/api/browse'
        resp = self._get(url)

        if resp != -1:
            return json.dumps(resp)
    
    # get products from vendor on main DB
    def vendor_products(self, vendor_id):
        url = f'https://cve.circl.lu/api/browse/{vendor_id}'
        resp = self._get(url)

        if resp != -1:
            return json.dumps(resp)
    
    # get CVEs on a product from main DB
    def get_product_cves(self, vendor_id, product_id):
        url = f'https://cve.circl.lu/api/search/{vendor_id}/{product_id}'
        resp = self._get(url)

        if resp != -1:
            return json.dumps(resp)
    
    # get CVE details from CVE ID from main DB
    def get_cve(self, cve_id):
        url = f'https://cve.circl.lu/api/cve/{cve_id}'
        resp = self._get(url)

        if resp != -1:
            return json.dumps(resp)
    
    # get the most recent 30 from main DB
    def get_recent(self, count=-1):
        if count == -1:
            url = 'https://cve.circl.lu/api/last'
        else:
            # make sure count is an interger
            try:
                last_count = int(count)
            except Exception as e:
                print(e)
                return ''
            
            url = 'https://cve.circl.lu/api/last/'+str(last_count)

        resp = self._get(url)

        if resp != -1:
            return resp
